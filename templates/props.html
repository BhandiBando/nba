<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>NBA Top Props</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0d1117;color:#e6edf3;margin:0}
    .wrap{max-width:1100px;margin:40px auto;padding:0 16px}
    h1{color:#67b7ff;margin:0 0 8px}
    .sub{color:#9da7b3;margin:0 0 20px}
    .controls{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:16px}
    input,select,button{background:#0b1620;color:#e6edf3;border:1px solid #263241;border-radius:8px;padding:8px 10px}
    table{width:100%;border-collapse:collapse;margin-top:8px}
    th,td{padding:10px;border-bottom:1px solid #1f2937;text-align:left;font-size:14px}
    th{color:#9da7b3;font-weight:600}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;background:#0b2f44;color:#8edaff;font-size:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>NBA Top Props — Today</h1>
    <p class="sub">Ranked by 0.7×Hit% + 0.3×EV (DK &amp; FD)</p>

    <div class="controls">
      <label>Markets:
        <select id="markets" multiple size="5">
          <option value="player_points" selected>player_points</option>
          <option value="player_rebounds" selected>player_rebounds</option>
          <option value="player_assists" selected>player_assists</option>
          <option value="player_steals">player_steals</option>
          <option value="player_blocks">player_blocks</option>
        </select>
      </label>
      <label>Top K:
        <input id="topk" type="number" value="75" min="10" max="300"/>
      </label>
      <button id="refresh">Refresh</button>
    </div>

    <table id="tbl">
      <thead>
        <tr>
          <th>Game</th>
          <th>Book</th>
          <th>Player</th>
          <th>Market</th>
          <th>Line</th>
          <th>Pred</th>
          <th>Hit%</th>
          <th>EV/$</th>
          <th>Score</th>
          <th>Injury</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const tblBody = document.querySelector("#tbl tbody");
    const btn = document.getElementById("refresh");
    const sel = document.getElementById("markets");
    const topk = document.getElementById("topk");

    function selValues(el){
      return Array.from(el.options).filter(o=>o.selected).map(o=>o.value).join(",");
    }

    async function load(){
      const url = `/api/props?topk=${encodeURIComponent(topk.value)}&markets=${encodeURIComponent(selValues(sel))}`;
      const res = await fetch(url);
      const data = await res.json();

      tblBody.innerHTML = "";
      for (const r of data){
        const tr = document.createElement("tr");
        const hit = r.hit_prob==null ? "" : (r.hit_prob*100).toFixed(1)+"%";
        const ev = r.ev_per_$==null ? "" : r.ev_per_$.toFixed(3);
        const score = r.score==null ? "" : r.score.toFixed(3);
        tr.innerHTML = `
          <td>${r.away} @ ${r.home}</td>
          <td>${r.book}</td>
          <td>${r.player}</td>
          <td>${r.market}</td>
          <td>${r.line ?? ""}</td>
          <td>${r.pred_mean==null?"":r.pred_mean.toFixed(2)}</td>
          <td>${hit}</td>
          <td>${ev}</td>
          <td>${score}</td>
          <td>${r.injury_status ? `<span class="pill">${r.injury_status}</span>` : ""}</td>`;
        tblBody.appendChild(tr);
      }
    }

    btn.addEventListener("click", load);
    load();
  </script>
</body>
</html>
